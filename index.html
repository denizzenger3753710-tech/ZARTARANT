<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Valorant JS - Bela Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #050a14; font-family: 'Segoe UI', sans-serif; }
        #crosshair {
            position: absolute; top: 50%; left: 50%; width: 10px; height: 10px;
            border: 2px solid #00ffcc; transform: translate(-50%, -50%); pointer-events: none; z-index: 20;
        }
        #hud { position: absolute; width: 100%; height: 100%; pointer-events: none; color: white; }
        .hp-box { position: absolute; bottom: 30px; left: 50px; border-left: 4px solid #00ffcc; padding-left: 10px; }
        #settings { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); padding: 10px; color: white; pointer-events: auto; border: 1px solid #ff4655; }
        input[type="number"] { width: 50px; background: #111; color: #00ffcc; border: 1px solid #444; padding: 3px; }
        #kill-feed { position: absolute; top: 20%; right: 20px; color: #ff4655; font-weight: bold; font-size: 20px; text-shadow: 0 0 10px black; }
    </style>
</head>
<body>

    <div id="settings">
        SENS: <input type="number" id="sensInput" step="0.1" value="1.0">
    </div>

    <div id="kill-feed"></div>

    <div id="crosshair"></div>
    
    <div id="hud">
        <div class="hp-box"><div style="font-size: 40px; font-weight: bold;" id="hp-val">100</div></div>
        <div style="position: absolute; bottom: 30px; right: 50px; text-align: right;">
            <div style="color:#ff4655; font-weight:bold;">PHANTOM</div>
            <div style="font-size: 50px; font-weight:bold;" id="ammo-val">25</div>
        </div>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        let ammo = 25, hp = 100, sensitivity = 0.002;
        const enemies = [];
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // --- SES SİSTEMİ (BELA VE ATEŞ) ---
        function playShootSound() {
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = 'square'; osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            g.gain.setValueAtTime(0.05, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        function playBelaSound() {
            // Meşhur kafa vuruş "Kilink" sesi
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = 'sine'; osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.2);
            
            // Kill feed yazısı
            const feed = document.getElementById('kill-feed');
            feed.innerText = "☠ BELA ☠";
            setTimeout(() => feed.innerText = "", 1000);
        }

        // --- SAHNE ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x384a5c);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        // KRİTİK DÜZELTME: Mouse yamulmasını önleyen rotasyon sırası
        camera.rotation.order = 'YXZ'; 

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));

        // Zemin ve Duvarlar (Ascent Mid Esintisi)
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({color: 0x444444}));
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        function createWall(w, h, d, x, z) {
            const wall = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), new THREE.MeshStandardMaterial({color: 0x888888}));
            wall.position.set(x, h/2, z);
            scene.add(wall);
        }
        createWall(40, 10, 1, 0, -20); // Mid Koridor
        createWall(1, 10, 40, -15, 0); // Sol Duvar

        // --- BOTLAR (SİLAHLI) ---
        function spawnEnemy() {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(1, 1.8, 0.5), new THREE.MeshStandardMaterial({color: 0xff4655}));
            const gun = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 0.7), new THREE.MeshStandardMaterial({color: 0x000000}));
            gun.position.set(0.4, 0.2, -0.4);
            group.add(body, gun);
            group.position.set((Math.random()-0.5)*20, 0.9, -10 - Math.random()*10);
            group.userData = { lastShot: 0 };
            scene.add(group);
            enemies.push(group);
        }
        for(let i=0; i<3; i++) spawnEnemy();

        // --- OYUNCU SİLAH ---
        const playerGun = new THREE.Mesh(new THREE.BoxGeometry(0.15, 0.2, 0.7), new THREE.MeshStandardMaterial({color: 0x111111}));
        playerGun.position.set(0.4, -0.3, -0.6);
        camera.add(playerGun);
        scene.add(camera);

        // --- HASSASİYET KAYIT ---
        const sInp = document.getElementById('sensInput');
        if(localStorage.getItem('vSens')) {
            sInp.value = localStorage.getItem('vSens');
            sensitivity = 0.002 * sInp.value;
        }
        sInp.addEventListener('input', () => {
            sensitivity = 0.002 * sInp.value;
            localStorage.setItem('vSens', sInp.value);
        });

        // --- MOUSE HAREKET (YAMULMA OLMAZ) ---
        document.addEventListener('mousemove', (e) => {
            if(document.pointerLockElement) {
                camera.rotation.y -= e.movementX * sensitivity;
                let newX = camera.rotation.x - e.movementY * sensitivity;
                camera.rotation.x = Math.max(-1.5, Math.min(1.5, newX));
                // Z ekseni artık YXZ sırası sayesinde yanlara yatmayacak!
            }
        });

        document.addEventListener('mousedown', () => {
            if(document.pointerLockElement && ammo > 0) {
                ammo--;
                document.getElementById('ammo-val').innerText = ammo;
                playShootSound();
                
                const ray = new THREE.Raycaster();
                ray.setFromCamera(new THREE.Vector2(0,0), camera);
                const hits = ray.intersectObjects(enemies, true);
                if(hits.length > 0) {
                    playBelaSound(); // KİLİNK!
                    let b = hits[0].object.parent;
                    b.position.set((Math.random()-0.5)*20, 0.9, -10 - Math.random()*10);
                }
            }
        });

        let keys = {};
        document.addEventListener('keydown', (e) => keys[e.code] = true);
        document.addEventListener('keyup', (e) => keys[e.code] = false);

        function animate() {
            requestAnimationFrame(animate);
            if(document.pointerLockElement) {
                const speed = 0.15;
                if(keys['KeyW']) camera.translateZ(-speed);
                if(keys['KeyS']) camera.translateZ(speed);
                if(keys['KeyA']) camera.translateX(-speed);
                if(keys['KeyD']) camera.translateX(speed);
                camera.position.y = 1.6;

                enemies.forEach(b => {
                    b.lookAt(camera.position.x, 0.9, camera.position.z);
                    if(Date.now() - b.userData.lastShot > 3000) {
                        hp -= 5;
                        document.getElementById('hp-val').innerText = hp;
                        b.userData.lastShot = Date.now();
                    }
                });
            }
            renderer.render(scene, camera);
        }
        document.body.addEventListener('click', () => document.body.requestPointerLock());
        animate();
    </script>
</body>
</html>